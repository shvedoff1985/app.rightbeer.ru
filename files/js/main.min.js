let User=!1;function login(){if($("#preload").css("display","block"),setTimeout(function(){$("#preload").css("display","none")},650),Page="login",!User&&"login"==Page){$("#layout").removeAttr("page"),$("#layout").attr("page","login"),$("metajs").html(""),$(".name-layout .name").html("Авторизация"),$("#layout").html('<div class="logo">                <img src="files/images/logo-light.png" width="200">            </div>            <div class="box-login">                <div class="input-group">                    <label>Введите номер телефона</label>                    <input id="phone-mask" type="" name="" placeholder="+7 (___) ___-__-__">                </div>                <div class="input-group">                    <input id="submit-mask" type="submit" class="shadow-box" name="" value="Войти" disabled="disabled">                </div>                <div class="back-call">                    <a  href="tel:+79998886655">Обратная связь</a>                </div>            </div>'),$("#overlay").html('<div class="PIN">                <div class="input-group">                    <label>Введите код подтверждения (последние 4 цифры входящего звонка)</label>                    <input id="pin-mask" type="" name="" placeholder="_-_-_-_">                </div>            </div>            <div class="close"><i class="far fa-times-circle"></i></div>');let e;$(".box-login").on("input",function(){18==$("#phone-mask").val().length?$("#submit-mask").removeAttr("disabled"):$("#submit-mask").attr("disabled","disabled")}),$(function(){$("#submit-mask").click(function(){$("#overlay").css("display","block"),$("#overlay").css("height",windowheight-55),$(".PIN").css("margin-top",(windowheight-$(".PIN").height())/2-55-72);var a=new XMLHttpRequest;a.open("GET","https://smsc.ru/sys/send.php?login=shvedoff1985&psw=b12132ff02dd8e140df8fa5c59c23df1&phones="+$("#phone-mask").val()+"&mes=code&call=1&fmt=3",!1),a.send(),200!=a.status||(e=JSON.parse(a.responseText))}),$("#overlay .close").click(function(){$("#overlay").css("display","none")})}),$(".PIN").on("input",function(){7==$("#pin-mask").val().length&&(pincode=$("#pin-mask").val(),pincode=pincode.split("-").join(""),e=e.code,e=e.substr(2,6),pincode==e?($("#overlay").css("display","none"),$("#overlay").html(""),Phone=$("#phone-mask").val(),authorization()):alert("Неверный код"))});IMask(document.getElementById("phone-mask"),{mask:"+7 (000) 000-00-00"}),IMask(document.getElementById("pin-mask"),{mask:"0-0-0-0"})}$(".button").removeClass("active"),$("#tabbar .login.profile").html('<div onclick="login()" class="button active">            <div class="icon"><i class="far fa-user-circle"></i></div>            <div class="name">Войти</div>        <div>')}function authorization(){$("#preload").css("display","block"),Phone=Phone.split("+").join(""),Phone=Phone.split(" ").join(""),Phone=Phone.split("(").join(""),Phone=Phone.split(")").join(""),Phone=Phone.split("-").join(""),$.ajax({type:"POST",url:"https://app.maksf.ru/getcard.php",data:{phone:Phone,Authorization:"d3577f6c-05e4-430b-bfa9-561f4ad4b7ea",accept:"application/json"},success:function(a){card=JSON.parse(a),"Карта не найдена"==card.message||(localStorage.account="login",localStorage.CardNumber=card.number,localStorage.CardBalance=card.balance,localStorage.FormHolder=card.form.holder,localStorage.FormHolder=card.form.holder,localStorage.FormPhone=card.form.phone,localStorage.FormBirthdate=card.form.birthdate,profile()),setTimeout(function(){$("#preload").css("display","none")},650)}})}function RelBalance(){"login"==localStorage.account&&$.ajax({type:"POST",url:"https://app.maksf.ru/getcard.php",data:{phone:localStorage.FormPhone,Authorization:"d3577f6c-05e4-430b-bfa9-561f4ad4b7ea",accept:"application/json"},success:function(a){card=JSON.parse(a),localStorage.CardBalance!==card.balance&&(localStorage.CardBalance=card.balance,$("#layout .reload").html("<b>"+localStorage.CardBalance+"</b>"))}})}function profile(){$("#preload").css("display","block"),setTimeout(function(){$("#preload").css("display","none")},650),Page="profile",RelBalance(),setInterval(function(){RelBalance()},1e4),$("#layout").removeAttr("page"),$("#layout").attr("page","profile"),$("metajs").html(""),$(".name-layout .name").html("Профиль"),$("#layout").html('<div class="card">            <div class="title">                '+localStorage.FormHolder.toUpperCase()+'            </div>            <div class="code">                <svg id="barcode"></svg>            </div>        </div>        <div class="card balance">            <div class="balancet">                Баланс:             </div>            <div class="reload">                <b>'+localStorage.CardBalance+"</b>            </div>        </div>        "),JsBarcode("#barcode",localStorage.CardNumber),$(".button").removeClass("active"),"login"==localStorage.account?($("#tabbar .login.profile").html('<div onclick="profile()" class="button">                <div class="icon"><i class="fas fa-barcode"></i></div>                <div class="name">Профиль</div>            <div>'),$(".name-layout .exit").html('<i class="fas fa-sign-out-alt"></i>')):$("#tabbar .login.profile").html('<div onclick="login()" class="button">                <div class="icon"><i class="far fa-user-circle"></i></div>                <div class="name">Войти</div>            </div>'),tabbar_onclick(),$("#tabbar .login .button").addClass("active")}function news(){$("#preload").css("display","block"),Page="news",$("#layout").removeAttr("page"),$("#layout").attr("page","news"),$("metajs").html(""),$(".name-layout .name").html("Новости"),$("#layout").html('<div class="lineP"></div>');var a=new XMLHttpRequest;if(a.open("GET","https://app.maksf.ru/news.php",!1),a.send(),200!=a.status)$("#preload").css("display","block");else{setTimeout(function(){$("#preload").css("display","none")},650),News_arr=JSON.parse(a.responseText),News_Numm=Object.keys(News_arr).length;for(var e=1;e<News_Numm+1;e++)$("#layout").append('<div class="card">                  <img src="'+News_arr[e].image+'">                  <div class="title">'+News_arr[e].name+'</div>                  <div class="text">'+News_arr[e].text+"</div>              </div>              ")}$(".button").removeClass("active"),"login"==localStorage.account?($("#tabbar .login.profile").html('<div onclick="profile()" class="button">                <div class="icon"><i class="fas fa-barcode"></i></div>                <div class="name">Профиль</div>            <div>'),$(".name-layout .exit").html('<i class="fas fa-sign-out-alt"></i>')):$("#tabbar .login.profile").html('<div onclick="login()" class="button">                <div class="icon"><i class="far fa-user-circle"></i></div>                <div class="name">Войти</div>            </div>'),tabbar_onclick(),$("#tabbar .news .button").addClass("active")}function stocks(){$("#preload").css("display","block"),setTimeout(function(){$("#preload").css("display","none")},650),Page="stocks",$("#layout").removeAttr("page"),$("#layout").attr("page","stocks"),$("metajs").html(""),$(".name-layout .name").html("Акции"),$("#layout").html('<div class="lineP"></div>');var a=new XMLHttpRequest;if(a.open("GET","https://app.maksf.ru/stocks.php",!1),a.send(),200!=a.status)$("#preload").css("display","block");else{setTimeout(function(){$("#preload").css("display","none")},650),News_arr=JSON.parse(a.responseText),News_Numm=Object.keys(News_arr).length;for(var e=1;e<News_Numm+1;e++)$("#layout").append('<div class="card">                  <img src="'+News_arr[e].image+'">                  <div class="title">'+News_arr[e].name+'</div>                  <div class="text">'+News_arr[e].text+"</div>              </div>              ")}$(".button").removeClass("active"),"login"==localStorage.account?($("#tabbar .login.profile").html('<div onclick="profile()" class="button">                <div class="icon"><i class="fas fa-barcode"></i></div>                <div class="name">Профиль</div>            <div>'),$(".name-layout .exit").html('<i class="fas fa-sign-out-alt"></i>')):$("#tabbar .login.profile").html('<div onclick="login()" class="button">                <div class="icon"><i class="far fa-user-circle"></i></div>                <div class="name">Войти</div>            </div>'),tabbar_onclick(),$("#tabbar .stocks .button").addClass("active")}function map(){$("#preload").css("display","block"),Page="map",$("#layout").removeAttr("page"),$("#layout").attr("page","map"),$(".name-layout .name").html("Карты"),$("#layout").html('<div id="map" style="width: 100%;"></div>'),$("metajs").html('<script src="https://api-maps.yandex.ru/2.1/?apikey=4589713e-a8e5-4019-bd5a-e4de5fb76b1d&lang=ru_RU" type="text/javascript"><\/script>'),$("#layout #map").css("height",$(document).height()-72-55),document.addEventListener("deviceready",function(){WonderPush.subscribeToNotifications(),options={maximumAge:36e5,timeout:4e3,enableHighAccuracy:!0},cordova.plugins.diagnostic.isLocationEnabled(function(a){a||cordova.plugins.diagnostic.switchToLocationSettings()},function(a){});navigator.geolocation.getCurrentPosition(function(o){$("#preload").css("display","none"),ymaps.ready(function(){var a=ymaps.geolocation,i=new ymaps.Map("map",{center:[o.coords.latitude,o.coords.longitude],zoom:13},{searchControlProvider:"yandex#search"});a.get({mapStateAutoApply:!0}).then(function(a){var e=a.geoObjects.get(0).properties.get("text"),s=a.geoObjects.get(0).geometry.getCoordinates();a.geoObjects.get(0).properties.set({balloonContentBody:"Адрес: "+e+"<br/>Координаты:"+s}),i.geoObjects.add(a.geoObjects)},function(a){});a=new XMLHttpRequest;if(a.open("GET","https://app.maksf.ru/getmap.php",!1),a.send(),200!=a.status)$("#preload").css("display","block");else{setTimeout(function(){$("#preload").css("display","none")},650),Point_arr=JSON.parse(a.responseText),Point_Numm=Object.keys(Point_arr).length;for(var e=0;e<Point_Numm;e++){var s=Point_arr[e].pos.split(" ")[0],t=Point_arr[e].pos.split(" ")[1];placemarki=new ymaps.Placemark([t,s],{balloonContentBody:"<strong>Right</strong><br/><strong>Адрес: </strong>"+Point_arr[e].address+"<br/><strong>Время работы: </strong>"+Point_arr[e].openHour+'<br/><strong>Телефон: </strong><a href="tel:'+Point_arr[e].phone+'" >'+Point_arr[e].phone+"</a>"},{iconLayout:"default#imageWithContent",iconImageHref:"files/images/PointMap.png",iconImageSize:[48,48],iconImageOffset:[-24,-24],iconContentOffset:[15,15]}),i.geoObjects.add(placemarki)}}})},function(a){},options)},!1),$(".button").removeClass("active"),"login"==localStorage.account?($("#tabbar .login.profile").html('<div onclick="profile()" class="button">                <div class="icon"><i class="fas fa-barcode"></i></div>                <div class="name">Профиль</div>            <div>'),$(".name-layout .exit").html('<i class="fas fa-sign-out-alt"></i>')):$("#tabbar .login.profile").html('<div onclick="login()" class="button">                <div class="icon"><i class="far fa-user-circle"></i></div>                <div class="name">Войти</div>            </div>'),tabbar_onclick(),$("#tabbar .map .button").addClass("active")}function tabbar_onclick(){"profile"==Page?$("#tabbar .login.profile").html('<div class="button">            <div class="icon"><i class="fas fa-barcode"></i></div>            <div class="name">Профиль</div>        <div>'):$("#tabbar .login.profile").html('<div onclick="profile()" class="button">            <div class="icon"><i class="fas fa-barcode"></i></div>            <div class="name">Профиль</div>        <div>'),"news"==Page?$("#tabbar .news").html('<div class="button">          <div class="icon"><i class="far fa-newspaper"></i></div>          <div class="name">Новости</div>      </div>'):$("#tabbar .news").html('<div onclick="news()" class="button">            <div class="icon"><i class="far fa-newspaper"></i></div>            <div class="name">Новости</div>        </div>'),"stocks"==Page?$("#tabbar .stocks").html('<div class="button">          <div class="icon"><i class="fas fa-tags"></i></div>          <div class="name">Акции</div>      </div>'):$("#tabbar .stocks").html('<div onclick="stocks()" class="button">            <div class="icon"><i class="fas fa-tags"></i></div>            <div class="name">Акции</div>        </div>'),"map"==Page?$("#tabbar .map").html('<div class="button">          <div class="icon"><i class="far fa-map"></i></div>          <div class="name">Карта</div>      </div>'):$("#tabbar .map").html('<div onclick="map()" class="button">            <div class="icon"><i class="far fa-map"></i></div>            <div class="name">Карта</div>        </div>')}First_exit=!1,Phone="",(Page="login")==localStorage.account?(User=!0,Page="profile",profile()):(User=!1,Page="login",login()),First_exit||setTimeout(function(){$("#preload-main").css("display","none")},1350),$(document).ready(function(){if(!User&&"login"==Page){$("#preload").css("display","block"),setTimeout(function(){$("#preload").css("display","none")},650),$("#layout").removeAttr("page"),$("#layout").attr("page","login"),$(".name-layout .name").html("Авторизация"),$("#layout").html('<div class="logo">                <img src="files/images/logo-light.png" width="200">            </div>            <div class="box-login">                <div class="input-group">                    <label>Введите номер телефона</label>                    <input id="phone-mask" type="" name="" placeholder="+7 (___) ___-__-__">                </div>                <div class="input-group">                    <input id="submit-mask" type="submit" class="shadow-box" name="" value="Войти" disabled="disabled">                </div>                <div class="back-call">                    <a  href="tel:+79998886655">Обратная связь</a>                </div>            </div>'),$("#overlay").html('<div class="PIN">                <div class="input-group">                    <label>Введите код подтверждения (последние 4 цифры входящего звонка)</label>                    <input id="pin-mask" type="" name="" placeholder="_-_-_-_">                </div>            </div>            <div class="close"><i class="far fa-times-circle"></i></div>');let e;$(".box-login").on("input",function(){18==$("#phone-mask").val().length?$("#submit-mask").removeAttr("disabled"):$("#submit-mask").attr("disabled","disabled")}),$(function(){$("#submit-mask").click(function(){$("#overlay").css("display","block"),$("#overlay").css("height",windowheight-55),$(".PIN").css("margin-top",(windowheight-$(".PIN").height())/2-55-72);var a=new XMLHttpRequest;a.open("GET","https://smsc.ru/sys/send.php?login=shvedoff1985&psw=b12132ff02dd8e140df8fa5c59c23df1&phones="+$("#phone-mask").val()+"&mes=code&call=1&fmt=3",!1),a.send(),200!=a.status||(e=JSON.parse(a.responseText))}),$("#overlay .close").click(function(){$("#overlay").css("display","none")})}),$(".PIN").on("input",function(){7==$("#pin-mask").val().length&&(pincode=$("#pin-mask").val(),pincode=pincode.split("-").join(""),e=e.code,e=e.substr(2,6),pincode==e?($("#overlay").css("display","none"),$("#overlay").html(""),Phone=$("#phone-mask").val(),authorization()):alert("Неверный код"))});IMask(document.getElementById("phone-mask"),{mask:"+7 (000) 000-00-00"}),IMask(document.getElementById("pin-mask"),{mask:"0-0-0-0"})}}),$(".exit").click(function(){$(".exit").html(""),delete localStorage.account,User=!1,Page="login",$("#tabbar .login.profile").html('<div onclick="login()" class="button">            <div class="icon"><i class="far fa-user-circle"></i></div>            <div class="name">Войти</div>        </div>'),$("#tabbar .news .button").addClass("active"),login()});
